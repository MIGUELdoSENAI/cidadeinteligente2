<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento de Bueiros - SmartCity</title>
    <link rel="stylesheet" href="/css/bueiros.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="/js/bueiros.js" defer></script>
</head>
<body>
    <!-- TOPBAR -->
    <header class="topbar">
        <div class="topbar-left">
            <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            <img src="Kapwbs.png" alt="KAPWBS Logo" class="logo-image">
        </div>

        <div class="topbar-right">
            <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">üåô</button>
            <div class="system-status">
                <span class="status-dot"></span>
                <span>Sistema Online</span>
            </div>
            <button class="logout-topbar" onclick="showLogoutPopup()">Logout</button>
        </div>
    </header>

    <!-- LOGOUT POPUP -->
    <div id="logoutPopup" class="popup-overlay">
        <div class="popup">
            <h3>Confirmar Logout</h3>
            <p>Deseja realmente sair do sistema?</p>
            <div class="popup-buttons">
                <button class="btn btn-cancel" onclick="closeLogoutPopup()">Cancelar</button>
                <button class="btn btn-logout" onclick="logout()">Sair</button>
            </div>
        </div>
    </div>

    <!-- SIDEBAR -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <i>üìä</i> Dashboard
            </a>
            <a href="bueiros.html" class="nav-item active">
                <i>üï≥Ô∏è</i> Bueiros
            </a>
            <a href="energia.html" class="nav-item">
                <i>‚ö°</i> Energia
            </a>
            <a href="materiaprima.html" class="nav-item">
                <i>‚ôªÔ∏è</i> Mat√©ria-Prima
            </a>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <!-- HEADER -->
        <div class="header">
            <h1>Monitoramento de Bueiros Inteligentes</h1>
            <p>Sistema avan√ßado de monitoramento em tempo real para preven√ß√£o de enchentes</p>
        </div>

        <!-- CONTROLES MELHORADOS -->
        <div class="controls-section">
            <div class="controls-grid">
                <div class="form-group">
                    <label class="form-label">üîç Buscar Bueiro</label>
                    <input type="text" class="search-input" id="searchInput" placeholder="Digite ID ou localiza√ß√£o...">
                </div>
                <div class="form-group">
                    <label class="form-label">üìä Filtrar Status</label>
                    <select class="filter-select" id="statusFilter">
                        <option value="">üîÑ Todos os Status</option>
                        <option value="normal">‚úÖ Normal</option>
                        <option value="warning">‚ö†Ô∏è Warning</option>
                        <option value="critical">üö® Critical</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="generateTXTReport()">
                    üìÑ Relat√≥rio
                </button>
            </div>
        </div>

        <!-- LAYOUT PRINCIPAL -->
        <div class="main-grid">
            <!-- GRID DE BUEIROS -->
            <div class="bueiros-section">
                <div class="section-title">
                    <span>üö∞</span>
                    <span>Bueiros Monitorados</span>
                    <span id="bueirosCount" style="margin-left: auto; font-size: 0.9rem; opacity: 0.8;"></span>
                </div>
                <div class="bueiros-grid" id="bueirosGrid">
                    <!-- Cards de bueiros ser√£o gerados dinamicamente -->
                </div>
            </div>

            <!-- PAINEL LATERAL -->
            <div class="stats-panel">
                <div class="section-title">
                    <span>üìà</span>
                    <span>Estat√≠sticas Gerais</span>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="avgLevel">0%</div>
                        <div class="stat-label">N√≠vel M√©dio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="criticalCount">0</div>
                        <div class="stat-label">Bueiros Cr√≠ticos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="lastMaintenance">--</div>
                        <div class="stat-label">√öltima Manuten√ß√£o</div>
                    </div>
                </div>

                <div class="alerts-section">
                    <div class="section-title">
                        <span>üö®</span>
                        <span>Alertas Recentes</span>
                    </div>
                    <div id="alertsList">
                        <!-- Alertas ser√£o gerados dinamicamente -->
                    </div>
                </div>

                <div class="chart-container">
                    <div class="section-title">
                        <span>üìä</span>
                        <span>Evolu√ß√£o Hist√≥rica</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="historicalChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAIS -->
    <!-- Modal de Detalhes -->
    <div id="detailsModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Detalhes do Bueiro</h3>
                <button class="modal-close" onclick="closeModal('detailsModal')">‚úï</button>
            </div>
            <div class="modal-content">
                <div id="detailsContent" class="detail-grid">
                    <!-- Conte√∫do ser√° preenchido dinamicamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Processo de Manuten√ß√£o -->
    <div id="maintenanceModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Processo de Manuten√ß√£o</h3>
                <button class="modal-close" onclick="closeModal('maintenanceModal')">‚úï</button>
            </div>
            <div class="modal-content">
                <div class="maintenance-process" id="maintenanceProcess">
                    <div class="process-step" id="step1">
                        <div class="step-icon">üöõ</div>
                        <div class="step-content">
                            <div class="step-title">Caminh√£o se deslocando para o destino</div>
                            <div class="step-description">Caminh√£o iniciando trajeto para o bueiro</div>
                        </div>
                    </div>
                    <div class="process-step" id="step2">
                        <div class="step-icon">üìç</div>
                        <div class="step-content">
                            <div class="step-title">Chegada ao Local</div>
                            <div class="step-description">Posicionamento sobre o bueiro</div>
                        </div>
                    </div>
                    <div class="process-step" id="step3">
                        <div class="step-icon">üßπ</div>
                        <div class="step-content">
                            <div class="step-title">Coleta de Detritos</div>
                            <div class="step-description">Aspira√ß√£o e limpeza em progresso</div>
                        </div>
                    </div>
                    <div class="process-step" id="step3-5">
                        <div class="step-icon">‚ôªÔ∏è</div>
                        <div class="step-content">
                            <div class="step-title">An√°lise e Separa√ß√£o de Res√≠duos</div>
                            <div class="step-description">Classifica√ß√£o de materiais recicl√°veis</div>
                        </div>
                    </div>
                    <div class="process-step" id="step4">
                        <div class="step-icon">üîç</div>
                        <div class="step-content">
                            <div class="step-title">Inspe√ß√£o Final</div>
                            <div class="step-description">Verifica√ß√£o da limpeza completa</div>
                        </div>
                    </div>
                    <div class="process-step" id="step5">
                        <div class="step-icon">üè†</div>
                        <div class="step-content">
                            <div class="step-title">Retorno √† Esta√ß√£o</div>
                            <div class="step-description">Caminh√£o retornando para base</div>
                        </div>
                    </div>
                </div>
                <div class="process-progress">
                    <div class="process-progress-bar" id="processProgressBar"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Registro de Mat√©ria-Prima -->
    <div id="materialsModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Registro de Mat√©ria-Prima Coletada</h3>
                <button class="modal-close" onclick="closeModal('materialsModal')">‚úï</button>
            </div>
            <div class="modal-content">
                <div class="materials-form">
                    <div class="form-group">
                        <label class="form-label">üî© Ferro (kg)</label>
                        <input type="number" id="ironInput" class="form-input" placeholder="Digite a quantidade de ferro" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ü™ü Vidro (kg)</label>
                        <input type="number" id="glassInput" class="form-input" placeholder="Digite a quantidade de vidro" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üå± Org√¢nicos (kg)</label>
                        <input type="number" id="organicInput" class="form-input" placeholder="Digite a quantidade de org√¢nicos" min="0" step="0.1">
                    </div>
                    <div class="materials-summary">
                        <div class="summary-item">
                            <span>Total de Materiais:</span>
                            <span id="totalMaterials" class="summary-value">0 kg</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="registerMaterials(currentBueiroId)" style="width: 100%;">
                        ‚úÖ Confirmar Registro de Materiais
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- TOOLTIP -->
    <div id="tooltip" class="tooltip"></div>

    <!-- NOTIFICA√á√ÉO -->
    <div id="notification" class="notification"></div>
</body>
</html>